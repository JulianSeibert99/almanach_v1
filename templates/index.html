{% extends "base.html" %}
{% block head %}
<script type="application/ld+json">
    {{ jsonld|safe }}
</script>
{% endblock %}
{% block content %}
<div class="hero-card">
    <h1>Staaten der Welt</h1>
    <p class="subtitle">Umfassende Fakten zu {{ states|length }} Ländern</p>
    <div class="search-wrapper">
        <input type="search" class="search" id="q" placeholder="Land suchen…" oninput="filterList()"
            autocomplete="off" />
    </div>
</div>

<section class="grid" id="list">
    <div id="no-results" class="no-results" style="display: none;">
        Keine Länder gefunden, die deiner Suche entsprechen.
    </div>
    {% for s in states %}
    <a class="state-card" data-name="{{ s.name|lower }}" href="{{ SITE_ROOT }}{{ s.url }}">
        {% if s.flag_code %}
        <img src="https://flagcdn.com/w40/{{ s.flag_code }}.png"
            srcset="https://flagcdn.com/w80/{{ s.flag_code }}.png 2x" class="flag-icon" alt="Flagge von {{ s.name }}">
        {% endif %}
        <h2>{{ s.name }}</h2>
        <div class="meta">{{ s.hint }}</div>
    </a>
    {% endfor %}
</section>

<script>
    function filterList() {
        const q = (document.getElementById("q").value || "").toLowerCase().trim();
        const cards = document.querySelectorAll("#list [data-name]");
        const noResults = document.getElementById("no-results");
        let visibleCount = 0;

        for (const el of cards) {
            const matches = el.dataset.name.includes(q);
            el.style.display = matches ? "" : "none";
            if (matches) visibleCount++;
        }

        if (noResults) {
            noResults.style.display = (visibleCount === 0 && q !== "") ? "block" : "none";
        }
    }

    // Beim Laden prüfen, ob ein Suchbegriff in der URL ist (?q=...)
    window.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const q = urlParams.get('q');
        if (q) {
            const input = document.getElementById("q");
            input.value = q;
            filterList();
        }
    });
</script>
{% endblock %}