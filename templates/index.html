{% extends "base.html" %}
{% block head %}
<script type="application/ld+json">
    {{ jsonld|safe }}
</script>
{% endblock %}
{% block content %}
<div class="hero-card">
    <h1>Staaten der Welt</h1>
    <p class="subtitle">Umfassende Fakten zu {{ states|length }} Ländern</p>
    <div class="search-wrapper">
        <input type="search" class="search" id="q" placeholder="Land suchen…" oninput="filterList()"
            autocomplete="off" />
    </div>
</div>

<section class="grid" id="list">
    {% for s in states %}
    <a class="state-card" data-name="{{ s.name|lower }}" href="{{ SITE_ROOT }}{{ s.url }}">
        <h2>{{ s.name }}</h2>
        <div class="meta">{{ s.hint }}</div>
    </a>
    {% endfor %}
</section>

<script>
    function filterList() {
        const q = (document.getElementById("q").value || "").toLowerCase().trim();
        const cards = document.querySelectorAll("#list [data-name]");
        let visibleCount = 0;

        for (const el of cards) {
            const matches = el.dataset.name.includes(q);
            el.style.display = matches ? "" : "none";
            if (matches) visibleCount++;
        }
    }

    // Beim Laden prüfen, ob ein Suchbegriff in der URL ist (?q=...)
    window.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const q = urlParams.get('q');
        if (q) {
            const input = document.getElementById("q");
            input.value = q;
            filterList();
        }
    });
</script>
{% endblock %}